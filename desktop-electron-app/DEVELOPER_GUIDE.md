# Xide Desktop Electron App - Полное руководство разработчика

## Обзор проекта

Electron desktop приложение для игрового магазина Xide, созданное с нуля с современным UI/UX в стиле Steam. Приложение полностью интегрировано с Django backend и обеспечивает все функции веб-версии с улучшенной производительностью и удобством использования.

## Архитектура

### Технологический стек

**Frontend:**
- Electron 28.x - фреймворк для кроссплатформенных desktop приложений
- Vanilla JavaScript (ES6+) - без дополнительных фреймворков
- CSS3 - современные стили с градиентами, анимациями и переходами
- Fetch API - для HTTP запросов к Django backend

**Backend Integration:**
- Django REST Framework - API endpoints
- Session-based аутентификация
- CSRF protection
- Cookie management

**Локальное хранилище:**
- electron-store - для сохранения пользовательских данных
- Безопасное хранение токенов и настроек

### Структура файлов

```
desktop-electron-app/
├── main.js                  # Главный процесс Electron
├── preload.js              # Preload скрипт (Context Bridge)
├── index.html              # Главная страница приложения
├── package.json            # Конфигурация npm и electron-builder
│
├── styles/                 # CSS стили
│   ├── main.css           # Базовые стили и навигация
│   ├── components.css     # Компоненты (карточки, уведомления)
│   ├── pages.css          # Стили страниц
│   └── auth.css           # Аутентификация и модальные окна
│
├── js/                     # JavaScript модули
│   ├── api.js             # XideAPI класс для работы с backend
│   ├── app.js             # Главное приложение (App класс)
│   │
│   ├── components/        # Переиспользуемые компоненты
│   │   ├── game-card.js  # Карточка игры
│   │   └── modal.js      # Модальные окна
│   │
│   └── pages/            # Страницы приложения
│       ├── store-page.js      # Магазин
│       ├── library-page.js    # Библиотека
│       ├── cart-page.js       # Корзина
│       ├── profile-page.js    # Профиль
│       ├── login-page.js      # Вход/регистрация
│       └── game-detail-page.js # Детали игры
│
└── assets/               # Ресурсы (иконки, изображения)
```

## Ключевые компоненты

### 1. Главный процесс (main.js)

Управляет жизненным циклом приложения:
- Создание окна приложения
- Настройка безопасности (Context Isolation, отключение Node Integration)
- IPC обработчики для работы с electron-store
- Управление меню и системными событиями

### 2. Preload скрипт (preload.js)

Безопасный мост между рендерером и главным процессом:
- Expose API через contextBridge
- Безопасный доступ к electron-store
- Изоляция Node.js API от рендерера

### 3. API клиент (api.js)

Класс `XideAPI` для взаимодействия с Django:

**Основные методы:**
- `getGames(params)` - получение списка игр
- `getGame(slug)` - детали игры
- `getFeaturedGames()` - рекомендуемые игры
- `getNewGames()` - новинки
- `searchGames(query)` - поиск
- `getCategories()` - категории
- `getCart()` - корзина
- `addToCart(gameId)` - добавление в корзину
- `login(username, password)` - вход
- `register(...)` - регистрация
- `getUserLibrary()` - библиотека пользователя
- `getUserStats()` - статистика

**Особенности:**
- Автоматическое управление CSRF токенами
- Сохранение сессии в electron-store
- Обработка cookies через Fetch API
- Централизованная обработка ошибок

### 4. Главное приложение (app.js)

Класс `App` управляет всем приложением:

**Функции:**
- Инициализация API и страниц
- Маршрутизация между страницами
- Управление навигацией
- Обновление UI статуса
- Защита маршрутов (проверка авторизации)

### 5. Компоненты

#### GameCard (game-card.js)
Переиспользуемая карточка игры:
- Отображение обложки
- Информация о цене и скидках
- Кнопка добавления в корзину
- Переход к деталям игры
- Hover эффекты

#### Modal (modal.js)
Модальные окна:
- Динамическое создание
- ESC для закрытия
- Клик вне окна для закрытия
- Анимации появления/исчезновения

### 6. Страницы

#### StorePage (store-page.js)
Магазин с вкладками:
- Главная (рекомендуемые + новинки)
- Новинки
- Спецпредложения
- Категории с фильтром
- Поиск

#### LibraryPage (library-page.js)
Библиотека пользователя:
- Список купленных игр
- Кнопка "Играть"
- Проверка авторизации
- Автоматическое извлечение из заказов

#### CartPage (cart-page.js)
Корзина покупок:
- Список товаров
- Изменение количества
- Удаление товаров
- Сводка по заказу
- Форма оформления заказа

#### ProfilePage (profile-page.js)
Профиль пользователя:
- Информация о пользователе
- Статистика (игры, заказы, траты)
- История заказов
- Кнопка выхода

#### LoginPage & RegisterPage (login-page.js)
Аутентификация:
- Форма входа
- Форма регистрации
- Валидация полей
- Обработка ошибок
- Сохранение сессии

#### GameDetailPage (game-detail-page.js)
Детальная страница игры:
- Большое изображение
- Полное описание
- Метаданные (разработчик, дата, платформа)
- Скриншоты
- Кнопка добавления в корзину

## Дизайн-система

### Цветовая палитра (Steam-inspired)

```css
--steam-bg-dark: #1b2838          /* Основной фон */
--steam-bg-darker: #171a21        /* Темный фон */
--steam-bg-panel: #16202d         /* Панели */
--steam-bg-light: #2a475e         /* Светлые элементы */
--steam-accent-blue: #66c0f4      /* Акцент (синий) */
--steam-accent-hover: #417a9b     /* Hover состояние */
--steam-text-primary: #c7d5e0     /* Основной текст */
--steam-text-secondary: #8b929a   /* Вторичный текст */
--steam-success: #5c9e1f          /* Успех/покупка */
--steam-border: #2a3f5f           /* Границы */
--steam-discount: #4c6b22         /* Скидки */
```

### Типографика

- **Основной шрифт:** Segoe UI, Motiva Sans, Arial
- **Логотип:** Arial Black, жирный
- **Размеры:**
  - Заголовки: 24-42px
  - Основной текст: 14-16px
  - Малый текст: 12-13px

### Компоненты UI

**Кнопки:**
- Primary (зеленая) - основные действия
- Secondary (синяя) - вторичные действия
- Icon - с иконками
- Text - текстовые ссылки

**Карточки:**
- Темный фон с градиентами
- Тени и borders
- Hover эффекты (поднятие, свечение)
- Скругленные углы 4-8px

**Формы:**
- Темные input поля
- Синяя подсветка при фокусе
- Валидация с красными границами
- Placeholder текст

**Модальные окна:**
- Темный оверлей (85% прозрачности)
- Центрирование
- Анимация появления (scale + fade)
- Кнопка закрытия

## Интеграция с Django

### API Endpoints

Все запросы идут на `http://127.0.0.1:8000/api/`

**Игры:**
- `GET /games/` - список игр (с фильтрами)
- `GET /games/{slug}/` - детали игры
- Параметры: `?featured=true`, `?new=true`, `?category=slug`, `?search=query`

**Категории:**
- `GET /categories/` - список категорий

**Корзина:**
- `GET /cart/current/` - текущая корзина
- `POST /cart/add_item/` - добавить товар
- `POST /cart/update_item/` - обновить количество
- `POST /cart/remove_item/` - удалить товар
- `POST /cart/clear/` - очистить корзину

**Заказы:**
- `GET /orders/` - список заказов пользователя
- `POST /orders/` - создать заказ

**Аутентификация:**
- `POST /login/` - вход (form data)
- `POST /register/` - регистрация (form data)
- `GET /shop/logout/` - выход

### CSRF Protection

1. Получение токена с cookie при первом запросе
2. Отправка токена в header `X-CSRFToken`
3. Автоматическое обновление токена
4. Сохранение в electron-store

### Session Management

- Cookies управляются через Fetch API
- `credentials: 'include'` для всех запросов
- Session ID сохраняется автоматически
- Проверка авторизации через `isAuthenticated` флаг

## Безопасность

### Electron Security Best Practices

1. **Context Isolation:** Включен для изоляции кода
2. **Node Integration:** Отключен в renderer
3. **Preload Script:** Безопасный API через contextBridge
4. **Remote Module:** Отключен
5. **Web Security:** Включен

### Защита данных

- Пароли никогда не хранятся локально
- Только токены сессии в electron-store
- CSRF токены для всех POST запросов
- Валидация на клиенте и сервере

## Производительность

### Оптимизации

1. **Lazy Loading:**
   - Страницы создаются по требованию
   - Изображения загружаются асинхронно

2. **Кэширование:**
   - Данные категорий кэшируются
   - Минимальные повторные запросы

3. **Эффективный DOM:**
   - Минимальные манипуляции
   - Event delegation где возможно
   - Удаление элементов при навигации

4. **Asset оптимизация:**
   - Минимальные зависимости
   - Оптимизированные изображения
   - CSS без лишних правил

## Сборка и дистрибуция

### Electron Builder конфигурация

```json
"build": {
  "appId": "com.xide.desktop",
  "win": {
    "target": "nsis",
    "icon": "assets/icon.ico"
  },
  "nsis": {
    "oneClick": false,
    "allowToChangeInstallationDirectory": true
  }
}
```

### Процесс сборки

1. **Подготовка:**
   ```bash
   npm install
   ```

2. **Сборка:**
   ```bash
   npm run build
   ```

3. **Результат:**
   - Установочный .exe файл
   - Портабельная версия
   - В папке `dist/`

## Тестирование

### Ручное тестирование

**Чеклист функций:**
- [ ] Запуск приложения
- [ ] Загрузка магазина
- [ ] Поиск игр
- [ ] Фильтр по категориям
- [ ] Просмотр деталей игры
- [ ] Добавление в корзину
- [ ] Изменение корзины
- [ ] Регистрация
- [ ] Вход
- [ ] Просмотр библиотеки
- [ ] Просмотр профиля
- [ ] Оформление заказа
- [ ] Выход

### Тестирование API

1. Запустить Django сервер
2. Открыть DevTools (Ctrl+Shift+I)
3. Проверить Network tab
4. Проверить Console на ошибки

## Troubleshooting

### Частые проблемы

**1. Приложение не запускается:**
- Проверьте Node.js версию
- Переустановите зависимости
- Проверьте логи в консоли

**2. API не работает:**
- Запустите Django сервер
- Проверьте URL: http://127.0.0.1:8000
- Проверьте CORS настройки

**3. Не работает авторизация:**
- Очистите electron-store
- Перезапустите приложение
- Проверьте CSRF токены

**4. Изображения не загружаются:**
- Проверьте MEDIA_URL в Django
- Проверьте права на папку media/
- Проверьте сетевые запросы в DevTools

## Будущие улучшения

### Планируемые функции

1. **Offline режим:**
   - Кэширование игр
   - Работа без интернета
   - Синхронизация при подключении

2. **Уведомления:**
   - Нативные уведомления
   - Скидки и новинки
   - Статус заказов

3. **Автообновление:**
   - Проверка обновлений
   - Автоматическая установка
   - Changelog

4. **Дополнительные функции:**
   - Wishlist (список желаний)
   - Отзывы и рейтинги
   - Друзья и социальные функции
   - Достижения

5. **Производительность:**
   - Virtual scrolling для больших списков
   - Более агрессивное кэширование
   - Progressive loading

## Поддержка и контрибьюция

### Обратная связь

При обнаружении багов или предложениях:
1. Проверьте существующие issue
2. Создайте новое с подробным описанием
3. Приложите скриншоты/логи
4. Укажите версию приложения

### Разработка

Для участия в разработке:
1. Fork репозитория
2. Создайте feature branch
3. Следуйте code style
4. Тестируйте изменения
5. Создайте Pull Request

## Заключение

Xide Desktop App - это полнофункциональное, современное и безопасное приложение для игрового магазина, созданное с вниманием к деталям UI/UX и производительности. Приложение полностью интегрировано с Django backend и предоставляет удобный опыт использования, вдохновленный лучшими практиками Steam.

---

**Версия:** 1.0.0  
**Дата:** Ноябрь 2025  
**Автор:** Xide Development Team
